events {}
http {
    server {
        listen 80;

        # 1. Flask Manager
        location /new_game {
            proxy_pass http://127.0.0.1:5010/new_game;
            proxy_set_header Host $host;
        }

        # 2. The VNC Proxy
        # This handles both the web files (.html, .js) AND the websocket
        location ~ ^/view/(\d+)/(.*) {
            # Map the URL /view/6081/vnc.html to localhost:6081/vnc.html
            proxy_pass http://127.0.0.1:$1/$2;
            
            # Critical headers for WebSockets (prevents 'localhost' fallback)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            
            # Increase timeouts for gaming
            proxy_read_timeout 86400;
        }
    }
}